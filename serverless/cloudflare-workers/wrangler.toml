# Cloudflare Workers Configuration for Africa Payments MCP
name = "africa-payments-mcp"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Node.js compatibility
# This enables Node.js built-ins like crypto, buffer, etc.

[build]
command = "npm run build"

# Environment Variables
[vars]
NODE_ENV = "production"
LOG_LEVEL = "info"
DEFAULT_CURRENCY = "KES"
DEFAULT_COUNTRY = "KE"
DEFAULT_PROVIDER = "mpesa"
CACHE_ENABLED = "true"
IDEMPOTENCY_ENABLED = "true"
CIRCUIT_BREAKER_ENABLED = "true"

# KV Namespaces
[[kv_namespaces]]
binding = "CACHE_KV"
id = "your-cache-kv-namespace-id"
preview_id = "your-preview-cache-kv-namespace-id"

[[kv_namespaces]]
binding = "API_KEYS_KV"
id = "your-api-keys-kv-namespace-id"
preview_id = "your-preview-api-keys-kv-namespace-id"

[[kv_namespaces]]
binding = "IDEMPOTENCY_KV"
id = "your-idempotency-kv-namespace-id"
preview_id = "your-preview-idempotency-kv-namespace-id"

# Secrets (use `wrangler secret put` to set these)
# MPESA_CONSUMER_KEY
# MPESA_CONSUMER_SECRET
# MPESA_PASSKEY
# PAYSTACK_SECRET_KEY
# INTASEND_SECRET_KEY
# MTN_MOMO_API_KEY
# AIRTEL_MONEY_CLIENT_SECRET
# ENCRYPTION_KEY
# WEBHOOK_SECRET

# Routes (custom domains)
# [[routes]]
# pattern = "payments.yourdomain.com"
# custom_domain = true

# Environment-specific configurations
[env.staging]
name = "africa-payments-mcp-staging"

[env.staging.vars]
NODE_ENV = "staging"
LOG_LEVEL = "debug"
DEFAULT_CURRENCY = "KES"
DEFAULT_COUNTRY = "KE"

[env.production]
name = "africa-payments-mcp"

[env.production.vars]
NODE_ENV = "production"
LOG_LEVEL = "info"
DEFAULT_CURRENCY = "KES"
DEFAULT_COUNTRY = "KE"

# Analytics and observability
[observability]
enabled = true

[observability.logs]
enabled = true

# Rate limiting (requires Cloudflare Rate Limiting subscription)
# [[unsafe.bindings]]
# name = "RATE_LIMITER"
# type = "ratelimit"
# namespace_id = "1001"
# simple = { limit = 100, period = 60 }

# Durable Objects (for stateful operations if needed)
# [[durable_objects.bindings]]
# name = "CIRCUIT_BREAKER"
# class_name = "CircuitBreaker"

# [[migrations]]
# tag = "v1"
# new_classes = ["CircuitBreaker"]
